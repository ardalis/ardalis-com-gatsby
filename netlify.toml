[build]
  publish = "public"
  command = "npm run build"
  functions = "lambda"

[build.environment]
  NODE_VERSION = "18"
  NPM_FLAGS = "--legacy-peer-deps"

# Branch-specific configuration for Hugo beta
[context.branch-deploy]
  command = "cd beta && hugo --minify -b $DEPLOY_PRIME_URL"
  publish = "beta/public"
  
[context.branch-deploy.environment]
  HUGO_VERSION = "0.150.1"

# Specific branch configuration for hugo-beta branch
[context."hugo-beta"]
  base = "beta"
  command = "hugo --minify -b $DEPLOY_PRIME_URL"
  publish = "beta/public"
  
[context."hugo-beta".environment]
  HUGO_VERSION = "0.150.1"

# Deploy previews for hugo-beta branch (PRs targeting hugo-beta)
[context.deploy-preview."hugo-beta"]
  base = "beta"
  command = "hugo --minify -b $DEPLOY_PRIME_URL"
  publish = "beta/public"
  
[context.deploy-preview."hugo-beta".environment]
  HUGO_VERSION = "0.150.1"

# Production remains Gatsby
[context.production]
  command = "npm run build"
  publish = "public"
  functions = "lambda"

# Deploy previews - check if it's a Hugo branch by looking for beta folder
[context.deploy-preview]
  command = "bash ./build-script.sh"
  publish = "public"

[[plugins]]
package = "netlify-plugin-gatsby-cache"
